(this.webpackJSONPwpmdb=this.webpackJSONPwpmdb||[]).push([[6],{588:function(t,e,n){"use strict";n.r(e),n.d(e,"setConnectionStatus",function(){return N}),n.d(e,"setConnectionStatusBatch",function(){return R}),n.d(e,"resetMigration",function(){return A}),n.d(e,"updateConnectionState",function(){return L}),n.d(e,"setError",function(){return U}),n.d(e,"copyLicenseToRemote",function(){return V}),n.d(e,"updatePluginOnRemote",function(){return B}),n.d(e,"retryOverHTTP",function(){return I}),n.d(e,"shouldShowSSLNotice",function(){return M}),n.d(e,"setConnectedProfileName",function(){return D}),n.d(e,"handleTableSelects",function(){return z}),n.d(e,"connectToRemote",function(){return W}),n.d(e,"changeConnection",function(){return F});var r=n(12),a=n(2),c=n(3),o=n.n(c),i=n(8),u=n(20),s=n.n(u),l=n(9),p=n(1),b=n(6),f=function(t){var e=0,n=window.WPMDBStore.getState();if(0===t.length)return window.wpmdb_strings.connection_info_missing;var a=function(t){var e=t.split("\n"),n=t;if(1===e.length){var r=t.trim().split(" ");2===r.length&&(!1===window.wpmdb_data.openssl_available&&(r[0]=r[0].replace("https://","http://")),n=r[0]+"\n"+r[1])}return n}(t),c=a.split("\n"),o=Object(r.a)(c,2),i=o[0],u=o[1];return Object(b.q)(i)?("undefined"!==typeof u&&(e=u.length),32!==e&&40!==e?window.wpmdb_strings.connection_info_key_invalid:i===window.wpmdb_data.connection_info[0]?window.wpmdb_strings.connection_info_local_url:u===n.settings.key?window.wpmdb_strings.connection_info_local_key:{url:i,key:u,str:a}):window.wpmdb_strings.connection_info_url_invalid},d=n(5),_=n(244),h=n(119),O=n(136),j=n(4),m=n(23),v=n(101),w=n(13),g=function(){return function(t,e){t(Object(d.a)(h.b,["connect"])),t(R({error:!0,button_status:"",connecting:!1}))}},y=n(32),k=n(298),x=n(40),S=n(118),T=function(t){var e,n=t.remote_site,r=t.local_site;switch(t.intent){case"pull":e={domain:{search:Object(b.l)(n.url),replace:Object(b.l)(r.this_url)},path:{search:n.path,replace:r.this_path}};break;case"push":e={domain:{search:Object(b.l)(r.this_url),replace:Object(b.l)(n.url)},path:{search:r.this_path,replace:n.path}};break;case"import":e={domain:{search:Object(b.l)(n.URL),replace:Object(b.l)(r.this_url)},path:{search:n.path,replace:r.this_path}}}return e.domain.enabled=!0,e.path.enabled=!0,e},C=n(27);function E(t,e,n){return function(r,a){var c=a();r({type:"UPDATE_REMOTE_SITE",payload:t.data});var o=T({intent:n,remote_site:t.data,local_site:c.migrations.local_site});o=r(Object(x.a)("wpmdb_standard_replace_values",o)),r(Object(C.f)(o));var i="pull"===n?t.data.prefix:c.migrations.local_site.this_prefix,u="pull"===n?c.migrations.local_site.this_prefix:t.data.prefix;return r(Object(m.i)(i,u)),!!e&&(r(function(t){return function(e){e({type:w.f,connected:t})}}(e)),r(function(t,e){return function(n,r){if(r().migrations.local_site.this_prefix!==t.data.prefix&&n(Object(d.a)("SET_CONNECTION_STATUS",{key:"prefix_mismatch",statusVal:!0})),Object(b.j)(e,r())&&n(Object(m.f)()),Object(b.i)(e,r()))return n(g()),n(function(t){t(Object(d.a)("SET_CONNECTION_STATUS",{key:"show_mst_warning",statusVal:!0})),t(Object(d.a)(w.g,!0))}),!1}}(t,n)))}}var P=function(t){t.connectionState;var e=t.result,n=void 0===e?null:e,r=t.intent,c=void 0===r?null:r;return function(t,e){Object(l.b)(function(){var r=M(e()),u=Object(a.a)(Object(a.a)({},S.a),{},{button_status:"hidden"});r&&(u.ssl_notice=!0),t(R(u)),t(z(Object(j.e)("this_tables",e()),n.data.tables,Object(j.d)(["intent","tables_selected","backup_option","backup_tables_selected"],e()))),t(Object(m.b)(!0)),!1!==t(E(n,!0,c))&&(t(D()),t(function(t,e){var n=["database","custom_fields","standard_fields","save_profile","theme_plugin_files"];Object(O.a)("status",e()).ssl_notice&&n.push("connect"),t(Object(x.a)("postConnectionPanelsOpen",n)),Object(l.b)(function(){t(Object(y.l)(n)),t(Object(x.b)("postConnectionPanels")),t(Object(y.a)("database","connect"))})}),t(function(){var t=Object(i.a)(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],window.hasOwnProperty("wpmdbmf")&&n.push("media_files"),window.hasOwnProperty("wpmdbtp")&&n.push("theme_plugin_files"),n.length>0&&(e(Object(y.b)(n)),e(Object(k.addonsLoaded)()));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()))})}},N=function(t,e){return Object(d.a)(_.a,{key:t,statusVal:e})},R=function(t){return function(e){e(Object(d.a)(_.b,t))}},A=function(t){return Object(d.a)(h.b,t)},L=function(t){return Object(d.a)(_.c,t)},U=function(t){return Object(d.a)(_.a,{key:"error",statusVal:t})},V=function(){return function(){var t=Object(i.a)(o.a.mark(function t(e,n){var r,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n(),a=r.migrations.connection_info.connection_state,t.next=4,Object(b.b)("/copy-license-to-remote",{url:a.url,key:a.key});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},B=function(t){return function(){var e=Object(i.a)(o.a.mark(function e(n,r){var a,c,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r(),c=a.migrations.connection_info.connection_state,e.prev=2,e.next=5,Object(b.b)("/update-plugin-on-remote",{url:c.url,key:c.key,slug:t});case 5:i=e.sent,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(2),"AbortError"!==e.t0.name){e.next=13;break}return console.log("fetch aborted",e.t0),e.abrupt("return");case 13:return n(H(e.t0.message)),e.abrupt("return",!1);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}},e,null,[[2,8]])}));return function(t,n){return e.apply(this,arguments)}}()},I=function(){return function(){var t=Object(i.a)(o.a.mark(function t(e,n){var r,c,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n(),c=Object(a.a)({},r.migrations.connection_info.connection_state),i=r.migrations.current_migration.intent,c.url=c.url.replace("https","http"),c.value=c.value.replace("https","http"),e(N("retry_over_http",!0)),e(L(c)),e(W(i));case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},M=function(t){return Object(O.a)("status",t).retry_over_http},D=function(){return function(t,e){var n=Object(j.d)("intent",e()),r=Object(j.e)("url",e());s()(["push","pull"],n)&&(r=Object(j.h)("url",e()));var a=r.replace(/(^\w+:|^)\/\//,""),c="push"===n?Object(p.b)(Object(p.a)("Push to %s","wp-migrate-db"),a):Object(p.b)(Object(p.a)("Pull from %s","wp-migrate-db"),a);t(Object(m.d)(c))}},J=function(t){return function(e){var n=new AbortController;return e(Object(d.a)("SET_ABORT_CONTROLLER",{key:t,controller:n})),n}},q=function(t){return function(e){Object(l.b)(function(){e(R({connecting:!0,button_status:"disabled"})),e(L(Object(a.a)({},t)))})}},z=function(t,e,n){var a=Object(r.a)(n,4),c=a[0],o=a[1],i=a[2],u=a[3];return function(n,r){var a=t,s=e;"pull"===c&&(a=e,s=t);var l=a.filter(function(t){return o.includes(t)});if(l.length!==o.length&&n({type:w.x,payload:l}),"backup_manual_select"===i){var p=s.filter(function(t){return u.includes(t)});p.length!==u.length&&n({type:w.s,payload:p})}}},H=function(t){return function(e,n){var r,a=Object(v.a)(t);e((r=a,function(){var t=Object(i.a)(o.a.mark(function t(e,n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(M(n())&&e(N("ssl_notice",!0)),!r.includes("#197")){t.next=5;break}return e(I()),t.abrupt("return");case 5:r.includes("401 Unauthorized")&&e(R({show_auth_form:!0})),r.includes("#195")&&e(N("copy_to_remote",!0)),r.includes("#196")&&e(N("update_plugin_on_remote",!0)),e(N("error_msg",r));case 9:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())),Object(O.a)("status",n()).retry_over_http?e(R({retry_over_http:!1,ssl_notice:!0})):e(g())}},W=function(t){return function(){var e=Object(i.a)(o.a.mark(function e(n,r){var a,c,i,u;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(j.f)("connection_info",r()),c=a.connection_state,i=n(J("connect_to_remote")),n(q(c)),e.prev=3,e.next=6,Object(b.b)("/verify-connection",{url:c.url,key:c.key,intent:t},i);case 6:u=e.sent,e.next=16;break;case 9:if(e.prev=9,e.t0=e.catch(3),"AbortError"!==e.t0.name){e.next=14;break}return console.log("fetch aborted",e.t0),e.abrupt("return");case 14:return n(H(e.t0.message)),e.abrupt("return",!1);case 16:if(u.success){e.next=19;break}return n(H(u)),e.abrupt("return");case 19:return n(P({connectionState:c,result:u,intent:t})),e.abrupt("return",u);case 21:case"end":return e.stop()}},e,null,[[3,9]])}));return function(t,n){return e.apply(this,arguments)}}()},F=function(t){return function(){var e=Object(i.a)(o.a.mark(function e(n,r){var c,i,u,s,p,b,d;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r(),i=c.migrations.current_migration.intent,u=c.migrations.connection_info.status.pasted,n(R({error:!1,button_status:""})),s=t.connection_state,p=f(t),b=Object(a.a)(Object(a.a)({},s),{},{value:p.str,url:p.url,key:p.key}),"string"!==typeof p){e.next=11;break}return d=Object(a.a)(Object(a.a)({},s),{},{value:t}),Object(l.b)(function(){n(L(d)),n(R({error:!0,button_status:"disabled",error_msg:p}))}),e.abrupt("return",p);case 11:n(L(b)),u&&Object(l.b)(function(){n(W(i,!0)),n(N("pasted",!1))});case 13:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}}}]);